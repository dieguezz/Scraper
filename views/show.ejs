<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<LINK REL="STYLESHEET" HREF="/public/css/style.css">
<script src="https://code.jquery.com/jquery-2.1.1.min.js"> </script>
<script src="/public/js/ejs.js"></script>
</head>
<body>
    <aside>
    <form action="<%= site %>/scan">
    <input type="submit" value="Escanear web">
</form>
        <ul class="product_list">
<% for(var i=0; i<data.length; i++) {%>
   <li data-index="<%- i %>"><a href="#" class="title"><%= JSON.stringify(data[i]['Title'].replace(/\"/g, "")) %></a></li>
<% } %>
</ul>
    </aside>
    <div class="content">
    <canvas id="canvas" height="600px" width="800px"></canvas>
    </div>

</body>
<footer>

    <script src="/public/js/Chart.js"></script>
    <script>
    $('ul.product_list').css('max-height',$(window).height() - 200);
    $('#canvas').css('max-height',$(window).height());
    var allData = <%- JSON.stringify(data) %>;
$(document).ready(function () {
    $('a').click(function (e) {
        e.preventDefault;
        var index = $(this).parent().data('index');
        var data = allData[index];
        var randomScalingFactor = function () {
            return Math.round(Math.random() * 100)
        };
        var lineChartData = {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [{
                label: "My First dataset",
                fillColor: "rgba(220,220,220,0.2)",
                strokeColor: "rgba(220,220,220,1)",
                pointColor: "rgba(220,220,220,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(220,220,220,1)",
                data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
            }, {
                label: "My Second dataset",
                fillColor: "rgba(151,187,205,0.2)",
                strokeColor: "rgba(151,187,205,1)",
                pointColor: "rgba(151,187,205,1)",
                pointStrokeColor: "#fff",
                pointHighlightFill: "#fff",
                pointHighlightStroke: "rgba(151,187,205,1)",
                data: [randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor(), randomScalingFactor()]
            }]

        };
        var convert = function (productResults) {
            var labels = [],
                data = [],
                stock = [];
            productResults.map(function(result) {
                labels.push(result.Fecha);
                data.push(result.Price);
                stock.push(result.Stock); 
            });


            return {
                labels: labels,
                datasets: [{
                    label: "Price",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: data
                }, {
                    label: "Stock",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
                    data: stock
                }]
            };
        };

        lineChartData = convert(data.Results);

        var ctx = document.getElementById("canvas").getContext("2d");
        window.myLine = new Chart(ctx).Line(lineChartData, {
            responsive: true,
            showTooltips: true
        });

    });
});
    </script>
</footer>
</html>
